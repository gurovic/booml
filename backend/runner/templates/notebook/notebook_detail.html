<!DOCTYPE html>
<html>
<head>
    <title>{{ notebook.title }}</title>
    {% load static %}
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            },
            svg: {
                fontCache: 'global'
            },
            startup: {
                typeset: false,
                ready: () => {
                    MathJax.startup.defaultReady();
                    if (window.NotebookUtils?.flushLatexQueue) {
                        window.NotebookUtils.flushLatexQueue();
                    }
                }
            }
        };
    </script>
    <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/markdown-it@13.0.1/dist/markdown-it.min.js"></script>
    <script src="{% static 'notebook/js/utils.js' %}"></script>
    <script src="{% static 'notebook/js/notebook_detail.js' %}"></script>
</head>
<body>
    <div id="notebook-{{ notebook.id }}"
         data-notebook-id="{{ notebook.id }}"
         data-create-cell-url="{% url 'runner:create_cell' notebook.id %}"
         data-create-latex-cell-url="{% url 'runner:create_latex_cell' notebook.id %}"
         data-runner-url="{% url 'runner:run_code' %}"
         data-delete-url-template="{% url 'runner:delete_cell' notebook.id 0 %}"
         data-save-output-url-template="{% url 'runner:save_cell_output' notebook.id 0 %}">

        <div class="notebook-header">
            <div class="notebook-header-title">
                <a class="notebook-back-link" href="{% url 'runner:notebook_list' %}">‚Üê –ö —Å–ø–∏—Å–∫—É –±–ª–æ–∫–Ω–æ—Ç–æ–≤</a>
                <h1 id="notebook-title">{{ notebook.title }}</h1>
            </div>
            <form id="rename-notebook-form"
                  class="notebook-rename-form"
                  method="post"
                  action="{% url 'runner:rename_notebook' notebook.id %}">
                {% csrf_token %}
                <label for="notebook-rename-input">–ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ:</label>
                <input type="text"
                       id="notebook-rename-input"
                       name="title"
                       value="{{ notebook.title }}"
                       placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –±–ª–æ–∫–Ω–æ—Ç–∞">
                <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </form>
        </div>

        <div class="notebook-actions">
            <form id="delete-notebook-form"
                  class="delete-notebook-form"
                  method="post"
                  action="{% url 'runner:delete_notebook' notebook.id %}">
                {% csrf_token %}
                <button type="submit" data-action="delete-notebook">üóë –£–¥–∞–ª–∏—Ç—å –±–ª–æ–∫–Ω–æ—Ç</button>
            </form>
            <button data-action="create-cell">‚ûï –ù–æ–≤–∞—è —è—á–µ–π–∫–∞</button>
            <button data-action="create-latex-cell">‚ûï –ù–æ–≤–∞—è LaTeX-—è—á–µ–π–∫–∞</button>
        </div>

        <div id="cells-container">
            {% for cell in cells %}
                {% include 'notebook/cell.html' with cell=cell notebook=notebook %}
            {% endfor %}
        </div>
    </div>

    {% csrf_token %}

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            notebookDetail.init({
                notebookId: {{ notebook.id }},
                csrfToken: '{{ csrf_token }}'
            });
        });
    </script>
</body>
</html>
