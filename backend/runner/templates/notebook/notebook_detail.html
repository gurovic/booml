<!DOCTYPE html>
<html>
<head>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/easymde/dist/easymde.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <title>{{ notebook.title }}</title>
    {% load static %}
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            },
            svg: {
                fontCache: 'global'
            },
            startup: {
                typeset: false,
                ready: () => {
                    MathJax.startup.defaultReady();
                    if (window.NotebookUtils?.flushLatexQueue) {
                        window.NotebookUtils.flushLatexQueue();
                    }
                }
            }
        };
    </script>
    <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/markdown-it@13.0.1/dist/markdown-it.min.js"></script>
    <script src="{% static 'notebook/js/utils.js' %}"></script>
    <script src="{% static 'notebook/js/notebook_detail.js' %}"></script>
    <script src="https://cdn.jsdelivr.net/npm/easymde/dist/easymde.min.js"></script>
</head>
<body>
    <div id="notebook-{{ notebook.id }}"
         data-notebook-id="{{ notebook.id }}"
         data-create-cell-url="{% url 'runner:create_cell' notebook.id %}"
         data-create-latex-cell-url="{% url 'runner:create_latex_cell' notebook.id %}"
         data-run-cell-url="{% url 'run-cell' %}"
         data-session-create-url="{% url 'notebook-session-create' %}"
         data-session-reset-url="{% url 'session-reset' %}"
         data-session-files-url="{% url 'session-files' %}"
         data-session-file-download-url="{% url 'session-file-download' %}"
         data-session-stop-url="{% url 'session-stop' %}"
         data-delete-url-template="{% url 'runner:delete_cell' notebook.id 0 %}"
         data-save-output-url-template="{% url 'runner:save_cell_output' notebook.id 0 %}"
         data-create-text-cell-url="{% url 'runner:create_text_cell' notebook.id %}"
         data-save-text-cell-url-template="{% url 'runner:save_text_cell' notebook.id 0 %}"
         data-export-notebook-url="{% url 'runner:export_notebook' notebook.id %}">

        <div class="notebook-header">
            <div class="notebook-header-title">
                <a class="notebook-back-link" href="{% url 'runner:notebook_list' %}">‚Üê –ö —Å–ø–∏—Å–∫—É –±–ª–æ–∫–Ω–æ—Ç–æ–≤</a>
                <h1 id="notebook-title">{{ notebook.title }}</h1>
            </div>
            <form id="rename-notebook-form"
                  class="notebook-rename-form"
                  method="post"
                  action="{% url 'runner:rename_notebook' notebook.id %}">
                {% csrf_token %}
                <label for="notebook-rename-input">–ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ:</label>
                <input type="text"
                       id="notebook-rename-input"
                       name="title"
                       value="{{ notebook.title }}"
                       placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –±–ª–æ–∫–Ω–æ—Ç–∞">
                <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </form>
        </div>

        <div class="session-controls" data-session-controls>
            <div class="session-status-row">
                <span>–°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Å—Å–∏–∏:</span>
                <span data-session-status>–°–µ—Å—Å–∏—è –Ω–µ —Å–æ–∑–¥–∞–Ω–∞</span>
            </div>
            <div class="session-actions">
                <button type="button" data-action="create-session">üöÄ –°–æ–∑–¥–∞—Ç—å —Å–µ—Å—Å–∏—é</button>
                <button type="button" data-action="reset-session">‚ôªÔ∏è –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Å—Å–∏—é</button>
                <button type="button" data-action="stop-session">‚èπ –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Å—Å–∏—é</button>
            </div>
        </div>

        <aside class="notebook-files-panel" data-files-panel>
            <div class="files-panel-header">
                <span>–§–∞–π–ª—ã —Å–µ—Å—Å–∏–∏</span>
                <button type="button" data-action="refresh-files">–û–±–Ω–æ–≤–∏—Ç—å</button>
            </div>
            <div class="files-panel-body" data-files-list>
                <div class="files-empty">–§–∞–π–ª—ã –µ—â—ë –Ω–µ —Å–æ–∑–¥–∞–Ω—ã</div>
            </div>
        </aside>

        <div class="notebook-actions">
            <form id="delete-notebook-form"
                  class="delete-notebook-form"
                  method="post"
                  action="{% url 'runner:delete_notebook' notebook.id %}">
                {% csrf_token %}
                <button type="submit" data-action="delete-notebook">üóë –£–¥–∞–ª–∏—Ç—å –±–ª–æ–∫–Ω–æ—Ç</button>
            </form>
            <button data-action="export-notebook">üì• –≠–∫—Å–ø–æ—Ä—Ç –Ω–æ—É—Ç–±—É–∫–∞</button>
            <button data-action="import-notebook">üì§ –ò–º–ø–æ—Ä—Ç –Ω–æ—É—Ç–±—É–∫–∞</button>
            <input type="file" id="import-file-input" accept=".json" style="display: none;" data-import-url="{% url 'runner:import_notebook' %}">
            <button data-action="create-cell">‚ûï –ù–æ–≤–∞—è —è—á–µ–π–∫–∞ –∫–æ–¥–∞</button>
            <button data-action="create-latex-cell">‚ûï –ù–æ–≤–∞—è LaTeX-—è—á–µ–π–∫–∞</button>
            <button data-action="create-text-cell">‚ûï –ù–æ–≤–∞—è —è—á–µ–π–∫–∞ —Ç–µ–∫—Å—Ç–∞</button>
        </div>

        <!-- –°–æ–æ–±—â–µ–Ω–∏—è –æ —Å—Ç–∞—Ç—É—Å–µ –∏–º–ø–æ—Ä—Ç–∞/—ç–∫—Å–ø–æ—Ä—Ç–∞ -->
        <div id="import-export-status" style="display: none; margin: 10px 0; padding: 10px; border-radius: 4px;"></div>

        <div id="cells-container">
            {% for cell in cells %}
                {% include 'notebook/cell.html' with cell=cell notebook=notebook %}
            {% endfor %}
        </div>
    </div>

    {% csrf_token %}

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            notebookDetail.init({
                notebookId: {{ notebook.id }},
                csrfToken: '{{ csrf_token }}',
                runCellUrl: '{% url "run-cell" %}',
                sessionCreateUrl: '{% url "notebook-session-create" %}',
                sessionResetUrl: '{% url "session-reset" %}',
                sessionFilesUrl: '{% url "session-files" %}',
                sessionFileDownloadUrl: '{% url "session-file-download" %}',
                sessionStopUrl: '{% url "session-stop" %}'
            });
        });
    </script>
</body>
</html>
