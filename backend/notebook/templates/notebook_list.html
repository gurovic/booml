<!DOCTYPE html>
<html>
<head>
    <title>Блокноты</title>
</head>
<body>
    <h1>Блокноты</h1>

    <button onclick="createNotebook()">Новый блокнот</button>

    <div>
        {% for notebook in notebooks %}
        <div>
            <a href="{% url 'notebook:notebook_detail' notebook.id %}">
                {{ notebook.title }}
            </a>
        </div>
        {% empty %}
        <p>Блокнотов пока нет. Нажмите «Новый блокнот», чтобы создать первый.</p>
        {% endfor %}
    </div>

    {% csrf_token %}

    <script src="{% url 'reverse_js' %}" type="text/javascript"></script>

    <script>
        const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;

        async function createNotebook() {
            try {
                const response = await fetch(Urls['notebook:create_notebook'](), {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': csrftoken
                    }
                });
                const data = await response.json();
                window.location.href = Urls['notebook:notebook_detail'](data.notebook_id);

            } catch (error) {
                alert('Ошибка при создании блокнота');
            }
        }
    </script>
</body>
</html>